import MDXRenderer from "../../components/MDXRenderer";
import CommentaryLayout from "../../components/CommentaryLayout";
import H2WithHash from "../../components/H2WithHash";
import Image from "next/image";
import netscapeImage from "../../public/images/netscape.gif"
import mosaicImage from "../../public/images/mosaic.gif"

下記のビデオは2024年8月に記録したNewsPicks社のウェブサイトです。Next.jsのSSRとGraphQLを使って作成されているようです。しかしUX上の大きな問題があります。

下記ビデオをご覧になっていただくとわかりますが、**ボタンをクリックしても全くフィードバックがなく**、1秒後ぐらいにやっと画面が切り替わります。ユーザは自分がちゃんとクリックしたかどうかに自信が持てず、不安になります。またサイト全体がモッサリしている感覚があります。

同じことはTurbo FramesやTurbo Streamsを使っている場合も起こります。ここでは問題の原因を解説し、解決策を紹介します。

<video width="733" height="606" controls className="my-8">
  <source src="/videos/newspicks.mov" type="video/mp4"></source>
</video>


<H2WithHash id="create-tabbed-menus-with-turbo-frames">Ajax/fetchではローディングアニメーションは表示されない</H2WithHash>

ウェブブラウザは30年前からローディングアニメーションを表示していました。これはページのデータが読み込まれている間、「ちゃんと働いているよ」の合図となり、特にネットワークが非常に遅かった時代には必須なUI要素でした。

現在でも主要なブラウザはいずれもこのようなローディングアニメーションを用意しています。以前ほどは目立ちませんが、ブラウザが動いているのかどうかは明確にわかります。

<div className="flex flex-wrap gap-2">
  <Image src={netscapeImage} className="w-24"></Image>
  <Image src={mosaicImage} className="w-24"></Image>
</div>

しかしこの**ローディングアニメーションは、Ajax/fetchを使った場合には表示されません**。ブラウザは自動的にアニメーションを稼働させないのです。

**開発者が意識してローディングアニメーションを設ける必要があります。** それを忘れると先ほどのNewspicksサイトのようなUXになってしまいます。

<H2WithHash id="loading-animations-with-native">ブラウザネイティブなMPAの場合</H2WithHash>

ブラウザネイティブなMPAの場合、30年前からローディングアニメーションが用意されています。

これを確認するには、まず[トップ画面最上部](/)で遅延(delay)を2000msに設定し、[ブラウザネイティブ(MPA)画面遷移のデモ画面](/api/hotwire/users?native=true)に移動してください。画面下部の「...へ遷移(Turbo Off)」のボタンをクリックすると、ブラウザネイティブの画面遷移をご確認いただけます。その時にブラウザネイティブのローディングアニメーションが表示されることをご確認ください。(Safariだったらロケーションバーの下部を青い線が横ぎります。Chromeの場合はタブのfaviconのところが回転アニメーションになります)

<H2WithHash id="loading-animations-with-turbo-drive">Turbo Driveの場合</H2WithHash>

Turbo Driveの場合はネイティブのMPAと非常によく似たローディングアニメーションがデフォルトで用意されています。

これを確認するには、まず[トップ画面最上部](/)で遅延(delay)を2000msに設定し、[Turbo Drive画面遷移遷移のデモ画面](/api/hotwire/users)に移動してください。画面下部の「...へ遷移(Turbo On)」のボタンをクリックすると、Turbo Driveの画面遷移をご確認いただけます。ローディングアニメーションはページコンテンツの最上部を横切る青い線になります。これはTurboが用意してくれているもので、[スタイルのカスタマイズ](https://turbo.hotwired.dev/handbook/drive#displaying-progress)が可能です。

<H2WithHash id="loading-animations-with-ssr">Next.js Pages Router SSRの場合</H2WithHash>

いよいよ一番最初で紹介したNewsPicksの問題の話です。

これを確認するには、まず[トップ画面最上部](/)で遅延(delay)を2000msに設定し、[Next.js Pages Router SSR画面遷移](/users_ssr)に移動してください。画面下部の「...へSSR」のボタンをクリックすると、Next.js Pages Router SSRの画面遷移をご確認いただけます




トップ画面で遅延を2000msに設定し、タブメニューUIの[JavaScriptなし](/api/hotwire/tabbed_segments_no_js)に移動してください。そして`User`、`Products`のタブをクリックしてください。これが30年前のMPAの状態です。ブラウザ固有のローディングアニメーションが表示されることをご確認ください。


export default function NewTabbedMenus({children}) {
  return <CommentaryLayout
    title="Loading Animations"
    subtitle="ローディングアニメーション"
    section="Commentary">
    <MDXRenderer>{children}</MDXRenderer>
  </CommentaryLayout>
}
